!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array"),require("d3-selection"),require("d3-shape"),require("d3-interpolate-path")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-selection","d3-shape","d3-interpolate-path"],n):n(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3)}(this,function(t,n,e,r,i){"use strict";function o(){function t(){Object.keys(L).forEach(function(t){var n=L[t];null!=n.style&&console.warn('Warning: chunkDefinitions expects "styles", but found "style" in '+t,n),null!=n.attr&&console.warn('Warning: chunkDefinitions expects "attrs", but found "attr" in '+t,n),null!=n.pointStyle&&console.warn('Warning: chunkDefinitions expects "pointStyles", but found "pointStyle" in '+t,n),null!=n.pointAttr&&console.warn('Warning: chunkDefinitions expects "pointAttrs", but found "pointAttr" in '+t,n)})}function o(t){var n=Object.keys(L),e=!0,r=!0;return t&&(e=!n.includes(w),r=!n.includes(S)),r&&n.unshift(S),e&&n.unshift(w),n.filter(function(t,n,e){return e.indexOf(t)===n})}function f(t,n){function e(n,e){function r(t,n){if(i)t.push([n]),i=!1;else{var e=t[t.length-1];e.push(n)}}var i=!0,o=n.reduce(function(o,u,a){var c=F(u),s=n[a-1],f=n[a+1];if(c===t)r(o,u);else{var l=!1;if(s){var d=q(F(s),c,e);d===t&&(r(o,u),l=!0,i=!1)}if(l||null==f)l||(i=!0);else{var p=q(c,F(f),e);p===t?(o.push([u]),l=!0,i=!1):i=!0}}return o},[]);return o}var r=o(!0),i=n.reduce(function(t,n){var i=e(n,r);return i&&i.length?t.concat(i):t},[]);return i}function l(t){var n=!0,e=t.reduce(function(t,e){if(!D(e))return n=!0,t;if(n)t.push([e]),n=!1;else{var r=t[t.length-1],i=r[r.length-1];E(i,e)?r.push(e):t.push([e])}return t},[]);return e}function d(t,n){var e=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],r=e?"pointAttrs":"attrs",i=e?"pointStyles":"styles";Object.keys(n[r]).forEach(function(e){t.attr(e,n[r][e])}),Object.keys(n[i]).forEach(function(e){t.style(e,n[i][e])})}function p(t,n){function e(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return Object.keys(e).reduce(function(r,i){var o=e[i];return"function"==typeof o&&(o=o(t,n)),r[i]=o,r},{})}var r={},i=o();return i.forEach(function(t){var n=L[t]||{},i={styles:Object.assign({},e(M),e((L[w]||{}).styles),t===S?e(I):void 0,e(n.styles)),attrs:Object.assign({},e(P),e((L[w]||{}).attrs),t===S?e(_):void 0,e(n.attrs))},o={fill:i.attrs.stroke,r:null==i.attrs["stroke-width"]?void 0:parseFloat(i.attrs["stroke-width"])+1};i.pointAttrs=Object.assign(o,e(R),e((L[w]||{}).pointAttrs),e(n.pointAttrs)),null!=i.pointAttrs.r&&(i.pointAttrs.r=parseFloat(i.pointAttrs.r));var u=n.pointAttrs&&null!=n.pointAttrs.fill?{}:{fill:i.styles.stroke};i.pointStyles=Object.assign(u,e(N),e((L[w]||{}).pointStyles),e(n.pointStyles)),r[t]=i}),r}function y(t,n,e,r,i,o,u){var a=u.split(" ")[0],c=r.selectAll("."+a).data(i,function(t){return t.id}),s=n?e.duration():0,f=n?e.delay():0;n?c.exit().transition().delay(f).duration(.05*s).attr("r",1e-6).remove():c.exit().remove();var l=c.enter().append("circle");if(d(l,o,!0),l.classed(u,!0).attr("r",1e-6).attr("cx",function(t){return O(t.data)}).attr("cy",function(t){return C(t.data)}),(!t||t&&z)&&n){var p=.15*s;l.transition(e).delay(f+(s-p)).duration(p).attr("r",o.pointAttrs.r)}else l.attr("r",o.pointAttrs.r);n&&(c=c.transition(e)),c.attr("r",o.pointAttrs.r).attr("cx",function(t){return O(t.data)}).attr("cy",function(t){return C(t.data)})}function v(t,n,r,i,o,u,c,s,f,l){function d(t){t.attr("x",function(t){var n=O(t[0]);return n===y?n-j:n}).attr("width",function(t){var n=O(t[0]),e=O(t[t.length-1]);return n===y&&(n-=j),e===v&&(e+=j),e-n}).attr("y",w).attr("height",S)}var p=a(u,2),y=p[0],v=p[1],h=a(c,2),g=h[0],b=h[1],m=i.select("#"+l),k=i.select(".d3-line-chunked-debug");H&&k.empty()?k=i.append("g").classed("d3-line-chunked-debug",!0):H||k.empty()||k.remove();var x=m.selectAll("rect").data(o),A=void 0;H&&(A=k.selectAll("rect").data(o));var T=parseFloat(s.styles["stroke-width"]||f.style("stroke-width")||s.attrs["stroke-width"]),j=T,w=g-j,S=b+j-(g-j),C=void 0;if(n)!function(){var t=function(t,n){var e=O(t[0]),r=O(t[t.length-1]),i=e+(r-e)/2,o=n.find(function(t){return t[0]<=i&&i<=t[1]});return o?[Math.max(o[0],e),Math.min(r,o[1])]:[i,i]},n=function(n){n.attr("x",function(n){return t(n,c)[0]}).attr("width",function(n){var e=t(n,c),r=a(e,2),i=r[0],o=r[1];return o-i})},i=function(n){n.attr("x",function(n){return t(n,C)[0]}).attr("width",function(n){var e=t(n,C),r=a(e,2),i=r[0],o=r[1];return o-i}).attr("y",w).attr("height",S)},u=m.selectAll("rect").nodes();C=u.length?u.map(function(t){var n=e.select(t),r=parseFloat(n.attr("x")),i=parseFloat(n.attr("width"))+r;return[r,i]}):[[y,v]];var c=void 0;c=o.length?o.map(function(t){var n=O(t[0]),e=O(t[t.length-1]);return[n,e]}):[[0,0]],x.exit().transition(r).call(n).remove();var s=x.enter().append("rect").call(i);if(x=x.merge(s),x=x.transition(r),H){A.exit().transition(r).call(n).remove();var f=A.enter().append("rect").style("fill","rgba(255, 0, 0, 0.3)").style("stroke","rgba(255, 0, 0, 0.6)").call(i);A=A.merge(f),A=A.transition(r)}}();else{x.exit().remove();var D=x.enter().append("rect");if(x=x.merge(D),H){A.exit().remove();var E=A.enter().append("rect").style("fill","rgba(255, 0, 0, 0.3)").style("stroke","rgba(255, 0, 0, 0.6)");A=A.merge(E)}}x.call(d),H&&A.call(d)}function h(t,n,r,o,u,a,c,s,f,l){var p=o.select("."+f.split(" ")[0]);p.empty()&&(p=o.append("path"));var y=p;return l&&p.attr("clip-path","url(#"+l+")"),t&&p.attr("d",s(u)),d(p,a),p.classed(f,!0),n&&(p=p.transition(r)),p.attrTween?p.attrTween("d",function(){var t=e.select(this).attr("d"),n=c(u);return i.interpolatePath(t,n)}):p.attr("d",function(){return c(u)}),y}function g(t,n,e){var i=e[1],o=r.line().x(O).y(C).curve(W),u=void 0;if(B&&t.length){var a=t.map(function(t){return[O(t),C(t)]});t=[[B[0],a[0][1]]].concat(c(a),[[B[1],a[a.length-1][1]]]),o=r.line().curve(W)}return n&&(u=o,z&&(u=r.line().x(O).y(i).curve(W),B&&(u=r.line().y(i).curve(W)))),{line:o,initialLine:u||o,lineData:t}}function b(t,n){if(t!==S){var e=n.select("defs");e.empty()&&(e=n.append("defs"));var r="d3-line-chunked-clip-"+t,i=e.select("."+r);return i.empty()&&(i=e.append("clipPath").attr("class",r).attr("id","d3-line-chunked-clip-"+t+"-"+s++)),i.attr("id")}}function m(t,e,r,i,u,a){var c=G(u),s=c.filter(D),d=n.extent(s.map(function(t){return C(t)})),m=n.extent(s.map(function(t){return O(t)})),k=p(u,a),x=g(s,t,d),A=x.line,T=x.initialLine,j=x.lineData,E=o(),F=l(c);E.forEach(function(n){var o=b(n,i),u="d3-line-chunked-chunk-"+n;n===w?u="d3-line-chunked-defined "+u:n===S&&(u="d3-line-chunked-undefined "+u);var a=k[n],c=h(t,e,r,i,j,a,A,T,u,o);if(n!==S){var s=f(n,F),l=s.filter(function(t){return 1===t.length}).map(function(t){return{id:O(t[0]),data:t[0]}}),p=u.split(" ").map(function(t){return t+"-point"}).join(" ");y(t,e,r,i,l,a,p),v(t,e,r,i,s,m,d,a,c,o)}}),i.selectAll("circle").raise()}function k(n){if(n){var r=n.selection?n.selection():n;if(r&&!r.empty()){var i=!1;r!==n&&(i=!0),r.each(function(t,r){var o=e.select(this),u=o.select(".d3-line-chunked-defined").empty();m(u,i,n,o,t,r)}),t()}}}function x(t){var n=t.get,e=t.set,r=t.setType,i=t.asConstant;return function(t){return arguments.length?(!r&&null!=t||r&&("undefined"==typeof t?"undefined":u(t))===r?e(t):i&&null!=t&&e(i(t)),k):n()}}var A={fill:"none",stroke:"#222","stroke-width":1.5,"stroke-opacity":1},T={"stroke-dasharray":"2 2","stroke-opacity":.35},j={},w="line",S="gap",O=function(t){return t[0]},C=function(t){return t[1]},D=function(){return!0},E=function(){return!0},F=function(){return w},q=function(t,n,e){var r=e.indexOf(t),i=e.indexOf(n);return r>i?t:n},L={},W=r.curveLinear,M={},P=A,I={},_=T,N={},R=j,z=!0,B=void 0,G=function(t){return t},H=!1;return k.x=x({get:function(){return O},set:function(t){O=t},setType:"function",asConstant:function(t){return function(){return+t}}}),k.y=x({get:function(){return C},set:function(t){C=t},setType:"function",asConstant:function(t){return function(){return+t}}}),k.defined=x({get:function(){return D},set:function(t){D=t},setType:"function",asConstant:function(t){return function(){return!!t}}}),k.isNext=x({get:function(){return E},set:function(t){E=t},setType:"function",asConstant:function(t){return function(){return!!t}}}),k.chunk=x({get:function(){return F},set:function(t){F=t},setType:"function",asConstant:function(t){return function(){return t}}}),k.chunkLineResolver=x({get:function(){return q},set:function(t){q=t},setType:"function"}),k.chunkDefinitions=x({get:function(){return L},set:function(t){L=t},setType:"object"}),k.curve=x({get:function(){return W},set:function(t){W=t},setType:"function"}),k.lineStyles=x({get:function(){return M},set:function(t){M=t},setType:"object"}),k.gapStyles=x({get:function(){return I},set:function(t){I=t},setType:"object"}),k.pointStyles=x({get:function(){return N},set:function(t){N=t},setType:"object"}),k.lineAttrs=x({get:function(){return P},set:function(t){P=t},setType:"object"}),k.gapAttrs=x({get:function(){return _},set:function(t){_=t},setType:"object"}),k.pointAttrs=x({get:function(){return R},set:function(t){R=t},setType:"object"}),k.transitionInitial=x({get:function(){return z},set:function(t){z=t},setType:"boolean"}),k.extendEnds=x({get:function(){return B},set:function(t){B=t},setType:"object"}),k.accessData=x({get:function(){return G},set:function(t){G=t},setType:"function",asConstant:function(t){return function(n){return n[t]}}}),k.debug=x({get:function(){return H},set:function(t){H=t},setType:"boolean"}),k}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=function(){function t(t,n){var e=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)},s=0;t.lineChunked=o,Object.defineProperty(t,"__esModule",{value:!0})});