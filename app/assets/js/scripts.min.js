/*!
 * fastplate
 * Barebones Responsive SCSS Boilerplate with vertical rhythm
 * http://miduku.github.io/fastplate/example.html
 * @author Dustin Kummer
 * @version 0.0.1
 * Copyright 2017. MIT licensed.
 */
!function(t,e){"use strict";var n=function(){function e(t){var e,n,s=t.offsetHeight;if(a)r=a();else for(var o in i)e=o,document.body.clientWidth>e&&e>=n&&(r=i[o],n=e);t.style.marginBottom=r-s%r+"px"}function n(n){e(n),"addEventListener"in t?t.addEventListener("resize",function(){e(n)},!1):"attachEvent"in t&&t.attachEvent("resize",function(){e(n)})}var a,r=0,i={};return function(t,e){var s="string"==typeof t?document.querySelectorAll(t):t,o=s.length;if("number"==typeof e)r=parseInt(e,10);else if("function"==typeof e)a=e;else if("object"==typeof e){var l=parseInt(getComputedStyle(document.body,null).getPropertyValue("font-size"),10);for(var c in i){var d=/\d+em/.test(c)?parseInt(c,10)*l:/\d+px/.test(c)?parseInt(c,10):c;i[d]=parseInt(i[c],10)}}if(o>1)for(;o--;)n(s[o]);else n(s[0])}}();"undefined"!=typeof e?e.extend(e.fn,{baseline:function(t){return n(this,t)}}):t.baseline=n}(window,window.jQuery||window.Zepto||void 0),function(t,e,n,a,r){"use strict";function i(){f.navMain._this.not(".hidden").children("ul").find("i").each(function(e,n){e<g.iconPositionsArr.navIcons.length-1&&t(n).children(".waterpipeNav").css("height",s(g.iconPositionsArr.navIcons[e],g.iconPositionsArr.navIcons[e+1]))})}function s(t,e){return e.offset().top-t.offset().top-t.outerHeight()}function o(t,e){return e.offset().top-t.offset().top}function l(e,n,a,r,i){"undefined"!==i&&null!==i||(i=!1),f.win.outerWidth()>=e?n.removeClass(a[0]).addClass(a[1]).css({left:a[2]}):n.removeClass(r[0]).addClass(r[1]).css({left:r[2]}),i&&t(".click-overlay").removeClass("visible")}function c(t){var n=t.w,a=t.h,r=Math.min(n,a)/2,i=e.scaleOrdinal().range(t.colors),s=e.arc().outerRadius(r-50).innerRadius(0),o=e.arc().outerRadius(r-10).innerRadius(r-10),l=e.select(t.element).append("svg").attr("class","d3PieChart").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+n+" "+a).append("g").attr("class","g").attr("transform","translate("+.5*n+","+.5*a+")"),c=e.pie().sort(null).value(function(e){return e[t.dataValueString]});e.csv(t.data,t.dataType,function(e,n){if(e)throw e;l.append("g").attr("class","arcs"),l.append("g").attr("class","labels"),l.append("g").attr("class","lines");var a=l.select(".arcs").selectAll(".arc").data(c(n)).enter();a.append("path").attr("class","arc").attr("d",s).style("stroke","#ffffff").style("stroke-linejoin","round").style("stroke-width",2).style("fill",function(e){return i(e.data[t.dataKeyString])});var r=l.select(".labels").selectAll(".label").data(c(n)).enter();r.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform",function(t){return"translate("+o.centroid(t)+")"}).style("font-size","1.25em").text(function(e){return e.data[t.dataKeyString]+": "+e.data[t.dataValueString]});var d=l.select(".lines").selectAll(".line").data(c(n)).enter();d.append("circle").attr("class","lineCircle").attr("x",0).attr("y",0).attr("r",3).attr("transform",function(t){return"translate("+s.centroid(t)+")"}),d.append("line").attr("class","line").attr("stroke-width",1).attr("x1",function(t){return s.centroid(t)[0]}).attr("y1",function(t){return s.centroid(t)[1]}).attr("x2",function(t){return.93*o.centroid(t)[0]}).attr("y2",function(t){return.93*o.centroid(t)[1]})})}function d(n){var a=n.element,r=n.w,i=n.h,s=r-n.margin.left-n.margin.right,o=i-n.margin.top-n.margin.bottom,l=e.scaleBand().rangeRound([0,s]).padding(.1),c=e.scaleLinear().rangeRound([o,0]),d=e.select(a).append("svg").attr("class","d3BarChart").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+r+" "+i).append("g").attr("class","g").attr("transform","translate("+n.margin.left+","+n.margin.top+")");e.csv(n.data,n.dataType,function(r,i){if(r)throw r;l.domain(i.map(function(t){return t.Stadt})),c.domain([0,e.max(i,function(t){return t.Liter})]),d.append("g").attr("class","axis"),d.append("g").attr("class","bars"),d.append("g").attr("class","labels"),d.select(".axis").append("g").attr("class","axis-x").attr("transform","translate(0, "+o+")").call(e.axisBottom(l)),d.select(".axis").append("g").attr("class","axis-y").call(e.axisLeft(c).ticks(10)).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").style("font-style","italic").text(n.yAxisLabel);var s=d.select(".bars").selectAll(".bar").data(i).enter();s.append("rect").attr("class","bar").attr("x",function(t){return l(t.Stadt)}).attr("y",function(t){return c(t.Liter)}).attr("width",l.bandwidth()).attr("height",function(t){return o-c(t.Liter)}),e.selectAll(a+" .bar").each(function(e,a){t(this).attr("fill",function(){return"Potsdam"===e.Stadt?n.colors[1]:n.colors[0]})});var u=d.select(".labels").selectAll(".label").data(i).enter();u.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform","translate(0, -10)").attr("x",function(t){return l(t.Stadt)+l.bandwidth()/2}).attr("y",function(t){return c(t.Liter)}).text(function(t){return t.Liter})})}function u(t){var n=t.element,a=t.h,r=t.w,i=a-t.margin.left-t.margin.right,s=r-t.margin.top-t.margin.bottom,o=e.scaleBand().rangeRound([0,s]).paddingInner(.1),l=e.scaleBand().padding(.05),c=e.scaleLinear().rangeRound([i,0]),d=e.scaleOrdinal().range(t.colors),u=e.select(n).append("svg").attr("class","d3GroupedBarChart").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+r+" "+a).append("g").attr("class","g").attr("transform","translate("+t.margin.left+","+t.margin.top+")");e.csv(t.data,t.dataType,function(n,a){if(n)throw n;var r=a.columns.slice(1);o.domain(a.map(function(e){return e[t.dataKeyString]})),l.domain(r).rangeRound([0,o.bandwidth()]),c.domain([0,e.max(a,function(t){return e.max(r,function(e){return t[e]})})]),u.append("g").attr("class","axis"),u.append("g").attr("class","bars"),u.append("g").attr("class","labels"),u.select(".axis").append("g").attr("class","axis-x").attr("transform","translate(0, "+i+")").call(e.axisBottom(o)),u.select(".axis").append("g").attr("class","axis-y").call(e.axisLeft(c).ticks(null,"s")).append("text").attr("transform","rotate(-90)").attr("x",2).attr("y",6).attr("dy","0.71em").style("font-style","italic").text(t.yAxisLabel);var p=u.select(".bars").selectAll(".bar").data(a).enter().append("g").attr("transform",function(e){return"translate("+o(e[t.dataKeyString])+",0)"}).selectAll("rect").data(function(t){return r.map(function(e){return{key:e,value:t[e]}})}).enter();p.append("rect").attr("x",function(t){return l(t.key)}).attr("y",function(t){return c(t.value)}).attr("width",l.bandwidth()).attr("height",function(t){return i-c(t.value)}).attr("fill",function(t){return d(t.key)}),p.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform","translate(0, -10)").attr("x",function(t){return l(t.key)+l.bandwidth()/2}).attr("y",function(t){return c(t.value)}).text(function(t){return t.value});var f=u.select(".labels").selectAll(".label").data(r.slice().reverse()).enter().append("g").attr("class","label").attr("text-anchor","end").attr("transform",function(t,e){return"translate(0,"+((e+1)*-20-30)+")"});f.append("rect").attr("x",s-19).attr("width",19).attr("height",19).attr("fill",d),f.append("text").attr("x",s-24).attr("y",9.5).attr("dy","0.32em").text(function(t){return t})})}function p(n,a){var r=n.element,i=n.h,s=n.w,o=i-n.margin.left-n.margin.right,l=s-n.margin.top-n.margin.bottom,c=e.scaleTime().range([0,l]),d=e.scaleLinear().range([o,0]),u=e.scaleOrdinal().range(n.colors),p=e.select(r).append("svg").attr("class","d3MultiLineChart").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+s+" "+i).append("g").attr("class","g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),f=e.line().defined(function(t){return null!==t.liter}).curve(n.curveType).x(function(t){return c(t.date)}).y(function(t){return d(t.liter)});e.csv(n.data,n.dataType,function(i,s){if(i)throw i;var g=s.columns.slice(1).map(function(t){return{id:t,values:s.map(function(e){return{date:e.Jahr,liter:e[t]}})}});c.domain(e.extent(s,function(t){return t.Jahr})),d.domain([e.min(g,function(t){return e.min(t.values,function(t){return t.liter})}),e.max(g,function(t){return e.max(t.values,function(t){return t.liter})})]),u.domain(g.map(function(t){return t.id})),p.append("g").attr("class","axis"),p.append("g").attr("class","lines"),p.append("g").attr("class","labels"),p.append("g").attr("class","mouseovers"),p.select(".axis").append("g").attr("class","grid-x").attr("transform","translate(0,"+o+")").style("opacity","0.15").call(e.axisBottom(c).ticks(10).tickSize(-o).tickFormat("")),p.select(".axis").append("g").attr("class","grid-y").style("opacity","0.15").call(e.axisLeft(d).ticks(20).tickSize(-l).tickFormat("")),p.select(".axis").append("g").attr("class","axis-x").attr("transform","translate(0, "+o+")").call(e.axisBottom().scale(c).ticks(12)),p.select(".axis").append("g").attr("class","axis-y").call(e.axisLeft().scale(d).ticks(null,"s")).append("text").attr("transform","rotate(-90)").attr("y",16).attr("dy","0.32em").style("font-style","italic").text(n.yAxisLabel);var h=p.select(".lines").selectAll(".line").data(g).enter();if(h.append("path").attr("class",function(t){return"line line"+t.id}).attr("d",function(t){return f(t.values)}).style("fill","none").style("stroke-width",2).style("stroke",function(t){return u(t.id)}),a){console.log("showing Dots");var m=p.select(".lines").selectAll(".dots").data(g).enter(),v=m.append("g").attr("class",function(t){return"dots dots"+t.id}).selectAll("circle").data(function(t){return t.values}).enter();v.append("circle").attr("cx",function(t){return c(t.date)}).attr("cy",function(t){return d(null!==t.liter?t.liter:"0")}).attr("r",function(t){return null!==t.liter?"2":"0"}).style("stroke","none")}var y=p.select(".labels").selectAll(".label").data(g).enter();y.append("text").datum(function(t){return{id:t.id,value:t.values[t.values.length-1]}}).attr("class","label").attr("transform",function(t){return"translate("+c(t.value.date)+", "+d(t.value.liter)+") rotate(15)"}).attr("x",3).attr("dy","0.35em").style("font-size","1.1em").text(function(t){return t.id}),p.select(".mouseovers").append("path").attr("class","mouseLine").style("stroke","#737373").style("stroke-width",1).style("opacity","0");var x=t(r+" .line"),w=p.select(".mouseovers").selectAll(".mousePerLine").data(g).enter().append("g").attr("class","mousePerLine");w.append("circle").attr("class","moCircle").attr("r",4).style("fill",function(t){return u(t.id)}).style("opacity","0"),w.append("rect").attr("class","moLabelBackground").style("fill","#fff"),w.append("text").attr("class","moText").style("font-size","1em");var b=t(r+" .moText"),A=e.range(b.length).map(function(){return{padding:1,boxHeight:20,translateX:10,translateY:3}});p.select(".mouseovers").append("rect").attr("width",l).attr("height",o).attr("pointer-events","all").style("fill","none").on("mouseout",function(){e.select(r+" .mouseLine").style("opacity","0"),e.selectAll(r+" .mousePerLine circle").style("opacity","0"),e.selectAll(r+" .mousePerLine rect").style("opacity","0"),e.selectAll(r+" .mousePerLine text").style("opacity","0")}).on("mouseover",function(){e.select(r+" .mouseLine").style("opacity","1"),e.selectAll(r+" .mousePerLine circle").style("opacity","1"),e.selectAll(r+" .mousePerLine rect").style("opacity","0.75"),e.selectAll(r+" .mousePerLine text").style("opacity","1")}).on("mousemove",function(){var n=e.mouse(this);e.selectAll(r+" .moText").each(function(e,n){t(this).attr("transform","translate("+A[n].translateX+","+A[n].translateY+")"),A[n].boxWidth=1.5*t(this).outerWidth()}),e.selectAll(r+" .moLabelBackground").each(function(e,n){t(this).attr("transform","translate("+(A[n].translateX-A[n].padding)+","+-4*A[n].translateY+")").attr("width",A[n].boxWidth).attr("height",A[n].boxHeight)}),e.select(r+" .mouseLine").attr("d",function(){var t="M"+n[0]+","+o;return t+=" "+n[0]+",0"}),e.selectAll(r+" .mousePerLine").attr("transform",function(t,a){for(var r=0,i=x[a].getTotalLength(),s=null,o=null;s=Math.floor((r+i)/2),o=x[a].getPointAtLength(s),s!==i&&s!==r||o.x===n[0];)if(o.x>n[0])i=s;else{if(!(o.x<n[0]))break;r=s}return e.select(this).select("text").text(d.invert(o.y).toFixed(0)),"translate("+n[0]+","+o.y+")"})})})}var f={win:t(n),bod:t("body"),navContainer:t(".nav-container"),wide:t("main .wide"),navMain:{_this:t(".nav-main"),a:t(".nav-main a"),icon:{_this:t(".nav-main ul i"),gewinnung:t(".nav-main-gewinnung i"),versorgung:t(".nav-main-versorgung i"),reinigung:t(".nav-main-reinigung i"),natur:t(".nav-main-natur i"),last:t(".nav-main-last i")}},section:{intro:t("#section-intro"),natur:t("#section-natur")},icon:{_this:t(".container .icon i"),gewinnung:t("#section-gewinnung .icon i"),versorgung:t("#section-versorgung .icon i"),reinigung:t("#section-reinigung .icon i"),natur:t("#section-natur .icon i")},footer:{_this:t("footer")}},g={iconPositionsArr:{mainIcons:[f.icon.natur,f.icon.gewinnung,f.icon.versorgung,f.icon.reinigung,f.footer._this],navIcons:[f.navMain.icon.natur,f.navMain.icon.gewinnung,f.navMain.icon.versorgung,f.navMain.icon.reinigung,f.navMain.icon.last]},colors:{gewinnung:[40,137,179],versorgung:[56,115,184],reinigung:[130,154,175],natur:[46,156,204]},offset:{fromTop:.75}},h="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",m={wVerteilung:{element:".d3Verteilung > .d3",w:800,h:470,colors:["#3873B8","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/taeglicher-gesamt-wasserbedarf-potsdams.csv",dataType:function(t){return t.Liter=+t.Liter,t},dataKeyString:"Kategorie",dataValueString:"Liter"},wFoerderkapazitaet:{element:".d3Foerderkapazitaet > .d3",w:850,h:470,colors:["#3873B8","#2889B3","#2E9CCC","#829AAF","#f44336"],data:"assets/data/foerderkapazitaet-wasserwerke-potsdam.csv",dataType:function(t){return t["Fördermenge in Kubikmeter"]=+t["Fördermenge in Kubikmeter"],t},dataKeyString:"Wasserwerk",dataValueString:"Fördermenge in Kubikmeter"},wVerbrauch:{element:".d3Verbrauch > .d3",w:800,h:490,margin:{top:20,right:40,bottom:20,left:50},colors:["#3873B8","#f44336","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/wasserverbrauch-proportianal-bevoelkerungsdichte.csv",dataType:function(t,n,a){var r=e.timeParse("%Y");t.Jahr=r(t.Jahr);for(var i,s=1,o=a.length;s<o;++s)t[i=a[s]]=+t[i];return t},curveType:e.curveStep,yAxisLabel:"Liter"},wAbgabe:{element:".d3Wasserabgabe > .d3",w:800,h:470,margin:{top:20,right:0,bottom:120,left:50},colors:["#3873B8","#f44336","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/wasserabgabe-versorgungsgebiet-potsdam-einwohner.csv",dataType:function(t,n,a){var r=e.timeParse("%Y");t.Jahr=r(t.Jahr);for(var i,s=1,o=a.length;s<o;++s)t[i=a[s]]="NaN"!==t[i]?+t[i]:null;return t},curveType:e.curveLinear,yAxisLabel:"m³/Tag"},wVerbrauch2:{element:".d3Verbrauch2 > .d3",w:800,h:470,margin:{top:20,right:0,bottom:40,left:50},colors:["#3873B8","#f44336"],data:"assets/data/wasserverbrauch-vergleich-partnerstaedte.csv",dataType:function(t){return t.Liter=+t.Liter,t},yAxisLabel:"Liter/Kopf"},wAuslastungsgrenze:{element:".d3Auslastungsgrenze > .d3",w:880,h:470,margin:{top:70,right:0,bottom:40,left:60},colors:["#3873B8","#2889B3","#2E9CCC","#829AAF","#f44336"],data:"assets/data/auslastungsgrenze-wasserwerke-potsdam-einwohner-szenario2047.csv",dataKeyString:"Jahr (Auslastung in %)",dataType:function(t,e,n){for(var a,r=1,i=n.length;r<i;++r)t[a=n[r]]="NaN"!==t[a]?+t[a]:null;return t},yAxisLabel:"m³/Tag"}},v={Controller:new ScrollMagic.Controller,scene:{NavSticky:new ScrollMagic.Scene({triggerElement:"#section-intro",triggerHook:0,duration:o(f.section.intro,f.section.natur)})},cast:{NavSticky:function(){return v.scene.NavSticky.addTo(v.Controller).on("progress resize",function(t){var e=t.progress;.5<=e&&e<1?l(768,f.navMain._this,["retracted hidden mobileAtTop","extended",0,!0],["retracted mobileAtTop","hidden extended",0]):1===e?l(768,f.navMain._this,["retracted mobileAtTop","hidden extended",0],["retracted mobileAtTop","hidden extended",0]):l(768,f.navMain._this,["extended hidden mobile","retracted",f.navContainer.offset().left],["","extended hidden mobileAtTop",0])})},Weather:function(t){var e=t.attr("id"),n=t.find(".weather");return new ScrollMagic.Scene({triggerElement:"#"+e,triggerHook:.5,duration:3*f.win.outerHeight()}).addTo(v.Controller).on("progress leave",function(t){var e=t.progress.toFixed(1);.1<e&&e<=.9&&"leave"!==t.type?n.css("opacity",1):n.css("opacity",0)})},Flood:function(e){return e.each(function(e,n){var a=t(n);new ScrollMagic.Scene({triggerElement:n,triggerHook:.6,duration:a.outerHeight()}).addTo(v.Controller).on("progress",function(t){var e=t.progress.toFixed(4);a.children(".flood").children(".circle").css({transform:"scale("+1.5*e+")"}),e>=.25?a.addClass("showText"):a.removeClass("showText")}).on("update leave",function(t){"leave"===t.type&&"FORWARD"===t.target.controller().info("scrollDirection")&&a.next(".container").css("opacity",1)})})},Waterpipe:function(e,n){var a=[g.colors.natur,g.colors.gewinnung,g.colors.versorgung,g.colors.reinigung,g.colors.natur];return e.each(function(e,r){var i=t(r),o=[a[e+1][0]-a[e][0],a[e+1][1]-a[e][1],a[e+1][2]-a[e][2]],l=new ScrollMagic.Scene({triggerElement:r,triggerHook:g.offset.fromTop}).addTo(v.Controller).on("progress",function(t){var n=t.progress.toFixed(4),r=100*n,s=r+"%",l=r*n+"%",c=[Math.round(a[e][0]+o[0]*n),Math.round(a[e][1]+o[1]*n),Math.round(a[e][2]+o[2]*n)],d="linear-gradient(to bottom, rgb("+a[e][0]+","+a[e][1]+","+a[e][2]+") 0%, rgb("+c.join(",")+") 100%)";i.children(".water").css({background:d,height:l}),f.navMain.icon._this.eq(e).children(".waterpipeNav").children(".water").css({background:d,height:s})});f.win.on("resize",function(){l.duration(s(n[e],n[e+1])),l.refresh()})})}}};t(function(){f.icon._this.append('<div class="waterpipe"><div class="water"></div></div>'),f.navMain._this.children("ul").find("li:not(:last) i").append('<div class="waterpipeNav"><div class="water"></div></div>'),f.wide.prepend('<div class="flood"><div class="circle"></div></div>'),f.section.natur.prepend('<div class="weather"><div class="rain"></div></div>'),f.bod.prepend('<div class="click-overlay"></div>'),f.navMain._this.prepend('<div class="click-navOverlay"></div>'),t('.nav-main:not(.hidden) a[href^="#"]').bind("click.smoothscroll",function(e){e.preventDefault();var a=this.hash,r=t(a);t(".click-overlay").removeClass("visible"),t("html, body").stop().animate({scrollTop:r.offset().top},900,"swing",function(){n.location.hash=a,f.navMain._this.addClass("hidden")})}),f.navMain._this.children(".click-navOverlay").on("click",function(e){e.preventDefault();var n=t(this).parent();n.hasClass("hidden")&&(n.removeClass("hidden").on(h,function(){i()}),t(".click-overlay").addClass("visible"))}),t(".click-overlay").on("click",function(e){e.preventDefault(),t(this).removeClass("visible"),f.navMain._this.not(".retracted").addClass("hidden")}),v.cast.Weather(t("#section-natur")),v.cast.Waterpipe(t(".waterpipe"),g.iconPositionsArr.mainIcons,"exponential"),v.cast.Flood(f.wide),v.cast.NavSticky(),c(m.wVerteilung),p(m.wVerbrauch),d(m.wVerbrauch2),p(m.wAbgabe,!0),c(m.wFoerderkapazitaet),u(m.wAuslastungsgrenze),f.win.trigger("resize"),f.win.on("load",function(){t(".loadWrapper").animate({opacity:0},500,function(){t(this).hide()})})}),f.win.on("resize",function(){f.section.intro.css("min-height",f.win.outerHeight()),f.section.natur.css({height:3.5*f.win.outerHeight(),marginBottom:f.win.outerHeight()}),t(".weather").css("height",f.section.natur.outerHeight()),t(".waterpipe").each(function(e,n){t(n).css("height",s(g.iconPositionsArr.mainIcons[e],g.iconPositionsArr.mainIcons[e+1]))}),f.wide.each(function(e,n){var a=t(n),r={_this:a.find(".icon i"),size:a.find(".icon i").outerWidth()},i={posTop:r._this.position().top,posLeft:r._this.offset().left,size:function(){return a.outerWidth()>a.outerHeight()?a.outerWidth():a.outerHeight()}};a.children(".flood").children(".circle").css({left:i.posLeft+r.size/2-i.size(),top:i.posTop+r.size/2-i.size(),width:2*i.size(),height:2*i.size()})})}),f.win.on("resize scroll",function(){i()})}(jQuery,d3,window,document);