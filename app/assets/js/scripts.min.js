/*!
 * fastplate
 * Barebones Responsive SCSS Boilerplate with vertical rhythm
 * http://miduku.github.io/fastplate/example.html
 * @author Dustin Kummer
 * @version 0.0.1
 * Copyright 2017. MIT licensed.
 */
!function(e,t){"use strict";var n=function(){function t(e){var t,n,s=e.offsetHeight;if(r)a=r();else for(var o in i)t=o,document.body.clientWidth>t&&t>=n&&(a=i[o],n=t);e.style.marginBottom=a-s%a+"px"}function n(n){t(n),"addEventListener"in e?e.addEventListener("resize",function(){t(n)},!1):"attachEvent"in e&&e.attachEvent("resize",function(){t(n)})}var r,a=0,i={};return function(e,t){var s="string"==typeof e?document.querySelectorAll(e):e,o=s.length;if("number"==typeof t)a=parseInt(t,10);else if("function"==typeof t)r=t;else if("object"==typeof t){var c=parseInt(getComputedStyle(document.body,null).getPropertyValue("font-size"),10);for(var l in i){var d=/\d+em/.test(l)?parseInt(l,10)*c:/\d+px/.test(l)?parseInt(l,10):l;i[d]=parseInt(i[l],10)}}if(o>1)for(;o--;)n(s[o]);else n(s[0])}}();"undefined"!=typeof t?t.extend(t.fn,{baseline:function(e){return n(this,e)}}):e.baseline=n}(window,window.jQuery||window.Zepto||void 0),function(e,t,n,r,a){"use strict";function i(e,t){return t.offset().top-e.offset().top-e.outerHeight()}function s(e,t){return t.offset().top-e.offset().top}function o(e,n,r,a,i){function s(e){return e.Value=+e.Value,e}var o=n,c=r,l=Math.min(o,c)/2,d=t.scaleOrdinal().range(a),u=t.arc().outerRadius(l-50).innerRadius(0),f=t.arc().outerRadius(l-10).innerRadius(l-10),v=i,g=t.select(e).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+o+" "+c).append("g").attr("class","g").attr("transform","translate("+.5*o+","+.5*c+")");g.append("g").attr("class","arcs"),g.append("g").attr("class","labels"),g.append("g").attr("class","lines");var p=t.pie().sort(null).value(function(e){return e.Value});t.csv(v,s,function(e,t){if(e)throw e;var n=g.select(".arcs").selectAll(".arc").data(p(t)).enter();n.append("path").attr("class","arc").attr("d",u).style("stroke","#ffffff").style("stroke-linejoin","round").style("stroke-width",2).style("fill",function(e){return d(e.data.Label)});var r=g.select(".labels").selectAll(".label").data(p(t)).enter();r.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform",function(e){return"translate("+f.centroid(e)+")"}).style("font-size","1.25em").style("color","#333").text(function(e){return e.data.Label+": "+e.data.Value});var a=g.select(".lines").selectAll(".line").data(p(t)).enter();a.append("circle").attr("class","lineCircle").attr("x",0).attr("y",0).attr("r",3).attr("fill","#333").attr("transform",function(e){return"translate("+u.centroid(e)+")"}),a.append("line").attr("class","line").attr("stroke-width",1).attr("stroke","#333").attr("x1",function(e){return u.centroid(e)[0]}).attr("y1",function(e){return u.centroid(e)[1]}).attr("x2",function(e){return.95*f.centroid(e)[0]}).attr("y2",function(e){return.95*f.centroid(e)[1]})})}function c(e,n,r,a,i,s){function o(e,t,n){e.Jahr=f(e.Jahr);for(var r,a=1,i=n.length;a<i;++a)e[r=n[a]]=+e[r];return e}var c=r,l=n,d=c-a.left-a.right,u=l-a.top-a.bottom,f=t.timeParse("%Y"),v=t.scaleTime().range([0,u]),g=t.scaleLinear().range([d,0]),p=t.scaleOrdinal().range(i),h=t.select(e).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+l+" "+c).attr("width",l).append("g").attr("class","g").attr("transform","translate("+a.left+","+a.top+")"),m=t.line().curve(t.curveBasis).x(function(e){return v(e.date)}).y(function(e){return g(e.liter)});t.csv(s,o,function(e,n){if(e)throw e;var r=n.columns.slice(1).map(function(e){return{id:e,values:n.map(function(t){return{date:t.Jahr,liter:t[e]}})}});v.domain(t.extent(n,function(e){return e.Jahr})),g.domain([t.min(r,function(e){return t.min(e.values,function(e){return e.liter})}),t.max(r,function(e){return t.max(e.values,function(e){return e.liter})})]),p.domain(r.map(function(e){return e.id})),h.append("g").attr("class","lines"),h.append("g").attr("class","axis"),h.select(".axis").append("g").attr("class","axis-x").attr("transform","translate(0, "+d+")").call(t.axisBottom(v)),h.select(".axis").append("g").attr("class","axis-y").call(t.axisLeft(g)).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("fill","#333").style("font-style","italic").text("Liter");var a=h.select(".lines").selectAll(".line").data(r).enter().append("g");a.append("path").attr("class",function(e){return"line line"+e.id}).attr("d",function(e){return m(e.values)}).style("fill","none").style("stroke-width",2).style("stroke",function(e){return p(e.id)}),a.append("text").datum(function(e){return{id:e.id,value:e.values[e.values.length-1]}}).attr("class","label").attr("transform",function(e){return"translate("+v(e.value.date)+", "+g(e.value.liter)+")"}).attr("x",3).attr("dy","0.35em").style("font-size","1.1em").text(function(e){return e.id})})}var l={win:e(n),bod:e("body"),navContainer:e(".nav-container"),wide:e("main .wide"),navMain:{_this:e(".nav-main"),a:e(".nav-main a"),icon:{_this:e(".nav-main ul i"),gewinnung:e(".nav-main-gewinnung i"),versorgung:e(".nav-main-versorgung i"),reinigung:e(".nav-main-reinigung i"),natur:e(".nav-main-natur i"),last:e(".nav-main-last i")}},section:{intro:e("#section-intro"),natur:e("#section-natur")},icon:{_this:e(".container .icon i"),gewinnung:e("#section-gewinnung .icon i"),versorgung:e("#section-versorgung .icon i"),reinigung:e("#section-reinigung .icon i"),natur:e("#section-natur .icon i")},footer:{_this:e("footer")}},d={iconPositionsArr:{mainIcons:[l.icon.natur,l.icon.gewinnung,l.icon.versorgung,l.icon.reinigung,l.footer._this],navIcons:[l.navMain.icon.natur,l.navMain.icon.gewinnung,l.navMain.icon.versorgung,l.navMain.icon.reinigung,l.navMain.icon.last]},colors:{gewinnung:[40,137,179],versorgung:[56,115,184],reinigung:[130,154,175],natur:[46,156,204]},offset:{fromTop:.75}},u={wasserbedarf:{element:".d3Verteilung > .d3",w:600,h:600,colors:["#3873B8","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/taeglicher-gesamt-wasserbedarf-potsdams.csv"},wasserverbrauch:{element:".d3Verbrauch > .d3",w:600,h:680,margin:{top:20,right:40,bottom:30,left:50},colors:["#3873B8","#f44336","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/wasserverbrauch-proportianal-bevoelkerungsdichte.csv"}};e(function(){l.icon._this.append('<div class="waterpipe"><div class="water"></div></div>'),l.navMain._this.children("ul").find("li:not(:last) i").append('<div class="waterpipeNav"><div class="water"></div></div>'),l.wide.prepend('<div class="flood"><div class="circle"></div></div>'),l.section.natur.prepend('<div class="weather"><div class="rain"></div></div>'),l.bod.prepend('<div class="click-overlay"></div>'),l.navMain._this.prepend('<div class="click-navOverlay"></div>'),e('.nav-main:not(.hidden) a[href^="#"]').bind("click.smoothscroll",function(t){t.preventDefault();var r=this.hash,a=e(r);e(".click-overlay").removeClass("visible"),e("html, body").stop().animate({scrollTop:a.offset().top},900,"swing",function(){n.location.hash=r,l.navMain._this.addClass("hidden")})}),l.navMain._this.children(".click-navOverlay").on("click",function(t){t.preventDefault();var n=e(this).parent();n.hasClass("hidden")&&(n.removeClass("hidden"),e(".click-overlay").addClass("visible"))}),e(".click-overlay").on("click",function(t){t.preventDefault(),e(this).removeClass("visible"),l.navMain._this.addClass("hidden")});var t={Controller:new ScrollMagic.Controller,scene:{NavSticky:new ScrollMagic.Scene({triggerElement:"#section-intro",triggerHook:0,duration:s(l.section.intro,l.section.natur)})},cast:{NavSticky:function(){return t.scene.NavSticky.addTo(t.Controller).addIndicators({name:"navSticky"}).on("progress resize",function(t){var n=t.progress;.5<=n&&n<1?(l.navMain._this.removeClass("retracted hidden").addClass("extended").css({left:0}),e(".click-overlay").removeClass("visible")):1===n?l.navMain._this.removeClass("retracted extended").addClass("hidden extended").css({left:0}):l.navMain._this.removeClass("extended hidden").addClass("retracted").css({left:l.navContainer.offset().left})})},Weather:function(e){var n=e.attr("id"),r=e.find(".weather");return new ScrollMagic.Scene({triggerElement:"#"+n,triggerHook:.5,duration:3*l.win.outerHeight()}).addTo(t.Controller).addIndicators({name:"weather"}).on("progress",function(e){var t=e.progress.toFixed(1);.1<t&&t<=.8?r.css("opacity",1):r.css("opacity",0)})},Flood:function(n){return n.each(function(n,r){var a=e(r);new ScrollMagic.Scene({triggerElement:r,triggerHook:.6,duration:a.outerHeight()}).addTo(t.Controller).addIndicators({name:"flood"+n}).on("progress",function(e){var t=e.progress.toFixed(3);a.children(".flood").children(".circle").css({transform:"scale("+t+")"}),t>=.25?a.addClass("showText"):a.removeClass("showText")}).on("update leave",function(e){"leave"===e.type&&"FORWARD"===e.target.controller().info("scrollDirection")&&a.next(".container").css("opacity",1)})})},Waterpipe:function(n,r){var a=[d.colors.natur,d.colors.gewinnung,d.colors.versorgung,d.colors.reinigung,d.colors.natur];return n.each(function(n,s){var o=e(s),c=[a[n+1][0]-a[n][0],a[n+1][1]-a[n][1],a[n+1][2]-a[n][2]],u=new ScrollMagic.Scene({triggerElement:s,triggerHook:d.offset.fromTop}).addTo(t.Controller).addIndicators({name:"Waterpipe"+n}).on("progress",function(e){var t=e.progress.toFixed(3),r=100*t,i=r+"%",s=r*t+"%",d=[Math.round(a[n][0]+c[0]*t),Math.round(a[n][1]+c[1]*t),Math.round(a[n][2]+c[2]*t)],u="linear-gradient(to bottom, rgb("+a[n][0]+","+a[n][1]+","+a[n][2]+") 0%, rgb("+d.join(",")+") 100%)";o.children(".water").css({background:u,height:s}),l.navMain.icon._this.eq(n).children(".waterpipeNav").children(".water").css({background:u,height:i})});l.win.on("resize",function(){u.duration(i(r[n],r[n+1])),u.refresh()})})}}};t.cast.Weather(e("#section-natur")),t.cast.Waterpipe(e(".waterpipe"),d.iconPositionsArr.mainIcons,"exponential"),t.cast.Flood(l.wide),t.cast.NavSticky(),o(u.wasserbedarf.element,u.wasserbedarf.w,u.wasserbedarf.h,u.wasserbedarf.colors,u.wasserbedarf.data),c(u.wasserverbrauch.element,u.wasserverbrauch.w,u.wasserverbrauch.h,u.wasserverbrauch.margin,u.wasserverbrauch.colors,u.wasserverbrauch.data),l.win.trigger("resize"),l.navMain._this.trigger("resize")}),l.win.on("resize",function(){l.section.intro.css("height",l.win.outerHeight()),l.section.natur.css({height:4*l.win.outerHeight(),marginBottom:l.win.outerHeight()}),e(".weather").css("height",l.section.natur.outerHeight()),e(".waterpipe").each(function(t,n){e(n).css("height",i(d.iconPositionsArr.mainIcons[t],d.iconPositionsArr.mainIcons[t+1]))}),l.navMain.icon._this.each(function(t,n){t<d.iconPositionsArr.navIcons.length-1&&e(n).children(".waterpipeNav").css("height",i(d.iconPositionsArr.navIcons[t],d.iconPositionsArr.navIcons[t+1]))}),l.wide.each(function(t,n){var r=e(n),a={_this:r.find(".icon i"),size:r.find(".icon i").outerWidth()},i={posTop:a._this.position().top,posLeft:a._this.offset().left,size:r.outerWidth()};r.children(".flood").children(".circle").css({left:i.posLeft+a.size/2-i.size,top:i.posTop+a.size/2-i.size,width:2*i.size,height:2*i.size})})})}(jQuery,d3,window,document);