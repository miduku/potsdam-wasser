/*!
 * fastplate
 * Barebones Responsive SCSS Boilerplate with vertical rhythm
 * http://miduku.github.io/fastplate/example.html
 * @author Dustin Kummer
 * @version 0.0.1
 * Copyright 2017. MIT licensed.
 */
!function(e,n){"use strict";var t=function(){function n(e){var n,t,o=e.offsetHeight;if(i)r=i();else for(var s in a)n=s,document.body.clientWidth>n&&n>=t&&(r=a[s],t=n);e.style.marginBottom=r-o%r+"px"}function t(t){n(t),"addEventListener"in e?e.addEventListener("resize",function(){n(t)},!1):"attachEvent"in e&&e.attachEvent("resize",function(){n(t)})}var i,r=0,a={};return function(e,n){var o="string"==typeof e?document.querySelectorAll(e):e,s=o.length;if("number"==typeof n)r=parseInt(n,10);else if("function"==typeof n)i=n;else if("object"==typeof n){var c=parseInt(getComputedStyle(document.body,null).getPropertyValue("font-size"),10);for(var l in a){var d=/\d+em/.test(l)?parseInt(l,10)*c:/\d+px/.test(l)?parseInt(l,10):l;a[d]=parseInt(a[l],10)}}if(s>1)for(;s--;)t(o[s]);else t(o[0])}}();"undefined"!=typeof n?n.extend(n.fn,{baseline:function(e){return t(this,e)}}):e.baseline=t}(window,window.jQuery||window.Zepto||void 0),function(e,n,t,i,r){"use strict";function a(e,n){return n.offset().top-e.offset().top-e.outerHeight()}function o(e,n){return n.offset().top-e.offset().top}function s(e,t,i,r){var a=e,o=t,s=Math.min(a,o)/2,l=n.scaleOrdinal().range(i),d=n.arc().outerRadius(s-50).innerRadius(0),u=n.arc().outerRadius(s-10).innerRadius(s-10),v=r,f=n.pie().sort(null).value(function(e){return e.Value}),g=n.select(".d3Verteilung > div").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+a+" "+o).append("g").attr("class","g").attr("transform","translate("+.5*a+","+.5*o+")");g.append("g").attr("class","arcs"),g.append("g").attr("class","labels"),g.append("g").attr("class","lines"),n.csv(v,c,function(e,n){if(e)throw e;var t=g.select(".arcs").selectAll(".arc").data(f(n)).enter();t.append("path").attr("class","arc").attr("d",d).style("stroke","#ffffff").style("stroke-linejoin","round").style("stroke-width",2).style("fill",function(e){return l(e.data.Label)});var i=g.select(".labels").selectAll(".label").data(f(n)).enter();i.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform",function(e){return"translate("+u.centroid(e)+")"}).style("font-size","1.25em").text(function(e){return e.data.Label+": "+e.data.Value});var r=g.select(".lines").selectAll(".line").data(f(n)).enter();r.append("circle").attr("class","lineCircle").attr("x",0).attr("y",0).attr("r",4).attr("fill","#000").attr("transform",function(e){return"translate("+d.centroid(e)+")"}).style("opacity",.6),r.append("line").attr("class","line").attr("stroke-width",2).attr("stroke","#000").attr("x1",function(e){return d.centroid(e)[0]}).attr("y1",function(e){return d.centroid(e)[1]}).attr("x2",function(e){return.95*u.centroid(e)[0]}).attr("y2",function(e){return.95*u.centroid(e)[1]}).style("opacity",.6)})}function c(e){return e.Value=+e.Value,e}var l={win:e(t),bod:e("body"),navContainer:e(".nav-container"),wide:e("main .wide"),navMain:{_this:e(".nav-main"),a:e(".nav-main a"),icon:{_this:e(".nav-main ul i"),gewinnung:e(".nav-main-gewinnung i"),versorgung:e(".nav-main-versorgung i"),reinigung:e(".nav-main-reinigung i"),natur:e(".nav-main-natur i"),last:e(".nav-main-last i")}},section:{intro:e("#section-intro"),natur:e("#section-natur")},icon:{_this:e(".container .icon i"),gewinnung:e("#section-gewinnung .icon i"),versorgung:e("#section-versorgung .icon i"),reinigung:e("#section-reinigung .icon i"),natur:e("#section-natur .icon i")},footer:{_this:e("footer")}},d={iconPositionsArr:{mainIcons:[l.icon.natur,l.icon.gewinnung,l.icon.versorgung,l.icon.reinigung,l.footer._this],navIcons:[l.navMain.icon.natur,l.navMain.icon.gewinnung,l.navMain.icon.versorgung,l.navMain.icon.reinigung,l.navMain.icon.last]},colors:{gewinnung:[40,137,179],versorgung:[56,115,184],reinigung:[130,154,175],natur:[46,156,204]},offset:{fromTop:.75}},u={wasserbedarf:{w:800,h:600,colors:["#2889B3","#3873B8","#829AAF","#2E9CCC"],data:"assets/data/taeglicher-gesamt-wasserbedarf-potsdams.csv"}};e(function(){l.icon._this.append('<div class="waterpipe"><div class="water"></div></div>'),l.navMain._this.children("ul").find("li:not(:last) i").append('<div class="waterpipeNav"><div class="water"></div></div>'),l.wide.prepend('<div class="flood"><div class="circle"></div></div>'),l.section.natur.prepend('<div class="weather"><div class="rain"></div></div>'),l.bod.prepend('<div class="click-overlay"></div>'),l.navMain._this.prepend('<div class="click-navOverlay"></div>'),e('.nav-main:not(.hidden) a[href^="#"]').bind("click.smoothscroll",function(n){n.preventDefault();var i=this.hash,r=e(i);e(".click-overlay").removeClass("visible"),e("html, body").stop().animate({scrollTop:r.offset().top},900,"swing",function(){t.location.hash=i,l.navMain._this.addClass("hidden")})}),l.navMain._this.children(".click-navOverlay").on("click",function(n){n.preventDefault();var t=e(this).parent();t.hasClass("hidden")&&(t.removeClass("hidden"),e(".click-overlay").addClass("visible"))}),e(".click-overlay").on("click",function(n){n.preventDefault(),e(this).removeClass("visible"),l.navMain._this.addClass("hidden")});var n={Controller:new ScrollMagic.Controller,scene:{NavSticky:new ScrollMagic.Scene({triggerElement:"#section-intro",triggerHook:0,duration:o(l.section.intro,l.section.natur)})},cast:{NavSticky:function(){return n.scene.NavSticky.addTo(n.Controller).addIndicators({name:"navSticky"}).on("progress resize",function(n){var t=n.progress;.5<=t&&t<1?(l.navMain._this.removeClass("retracted hidden").addClass("extended").css({left:0}),e(".click-overlay").removeClass("visible")):1===t?l.navMain._this.removeClass("retracted extended").addClass("hidden extended").css({left:0}):l.navMain._this.removeClass("extended hidden").addClass("retracted").css({left:l.navContainer.offset().left})})},Weather:function(e){var t=e.attr("id"),i=e.find(".weather");return new ScrollMagic.Scene({triggerElement:"#"+t,triggerHook:.5,duration:3*l.win.outerHeight()}).addTo(n.Controller).addIndicators({name:"weather"}).on("progress",function(e){var n=e.progress.toFixed(1);.1<n&&n<=.8?i.css("opacity",1):i.css("opacity",0)})},Flood:function(t){return t.each(function(t,i){var r=e(i);new ScrollMagic.Scene({triggerElement:i,triggerHook:.6,duration:r.outerHeight()}).addTo(n.Controller).addIndicators({name:"flood"+t}).on("progress",function(e){var n=e.progress.toFixed(3);r.children(".flood").children(".circle").css({transform:"scale("+n+")"}),n>=.25?r.addClass("showText"):r.removeClass("showText")}).on("update leave",function(e){"leave"===e.type&&"FORWARD"===e.target.controller().info("scrollDirection")&&r.next(".container").css("opacity",1)})})},Waterpipe:function(t,i){var r=[d.colors.natur,d.colors.gewinnung,d.colors.versorgung,d.colors.reinigung,d.colors.natur];return t.each(function(t,o){var s=e(o),c=[r[t+1][0]-r[t][0],r[t+1][1]-r[t][1],r[t+1][2]-r[t][2]],u=new ScrollMagic.Scene({triggerElement:o,triggerHook:d.offset.fromTop}).addTo(n.Controller).addIndicators({name:"Waterpipe"+t}).on("progress",function(e){var n=e.progress.toFixed(3),i=100*n,a=i+"%",o=i*n+"%",d=[Math.round(r[t][0]+c[0]*n),Math.round(r[t][1]+c[1]*n),Math.round(r[t][2]+c[2]*n)],u="linear-gradient(to bottom, rgb("+r[t][0]+","+r[t][1]+","+r[t][2]+") 0%, rgb("+d.join(",")+") 100%)";s.children(".water").css({background:u,height:o}),l.navMain.icon._this.eq(t).children(".waterpipeNav").children(".water").css({background:u,height:a})});l.win.on("resize",function(){u.duration(a(i[t],i[t+1])),u.refresh()})})}}};n.cast.Weather(e("#section-natur")),n.cast.Waterpipe(e(".waterpipe"),d.iconPositionsArr.mainIcons,"exponential"),n.cast.Flood(l.wide),n.cast.NavSticky(),s(u.wasserbedarf.w,u.wasserbedarf.h,u.wasserbedarf.colors,u.wasserbedarf.data),l.win.trigger("resize"),l.navMain._this.trigger("resize")}),l.win.on("resize",function(){l.section.intro.css("height",l.win.outerHeight()),l.section.natur.css({height:4*l.win.outerHeight(),marginBottom:l.win.outerHeight()}),e(".weather").css("height",l.section.natur.outerHeight()),e(".waterpipe").each(function(n,t){e(t).css("height",a(d.iconPositionsArr.mainIcons[n],d.iconPositionsArr.mainIcons[n+1]))}),l.navMain.icon._this.each(function(n,t){n<d.iconPositionsArr.navIcons.length-1&&e(t).children(".waterpipeNav").css("height",a(d.iconPositionsArr.navIcons[n],d.iconPositionsArr.navIcons[n+1]))}),l.wide.each(function(n,t){var i=e(t),r={_this:i.find(".icon i"),size:i.find(".icon i").outerWidth()},a={posTop:r._this.position().top,posLeft:r._this.offset().left,size:i.outerWidth()};i.children(".flood").children(".circle").css({left:a.posLeft+r.size/2-a.size,top:a.posTop+r.size/2-a.size,width:2*a.size,height:2*a.size})})})}(jQuery,d3,window,document);