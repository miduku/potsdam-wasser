/*!
 * fastplate
 * Barebones Responsive SCSS Boilerplate with vertical rhythm
 * http://miduku.github.io/fastplate/example.html
 * @author Dustin Kummer
 * @version 0.0.1
 * Copyright 2017. MIT licensed.
 */
!function(t,e){"use strict";var n=function(){function e(t){var e,n,s=t.offsetHeight;if(r)a=r();else for(var o in i)e=o,document.body.clientWidth>e&&e>=n&&(a=i[o],n=e);t.style.marginBottom=a-s%a+"px"}function n(n){e(n),"addEventListener"in t?t.addEventListener("resize",function(){e(n)},!1):"attachEvent"in t&&t.attachEvent("resize",function(){e(n)})}var r,a=0,i={};return function(t,e){var s="string"==typeof t?document.querySelectorAll(t):t,o=s.length;if("number"==typeof e)a=parseInt(e,10);else if("function"==typeof e)r=e;else if("object"==typeof e){var l=parseInt(getComputedStyle(document.body,null).getPropertyValue("font-size"),10);for(var c in i){var d=/\d+em/.test(c)?parseInt(c,10)*l:/\d+px/.test(c)?parseInt(c,10):c;i[d]=parseInt(i[c],10)}}if(o>1)for(;o--;)n(s[o]);else n(s[0])}}();"undefined"!=typeof e?e.extend(e.fn,{baseline:function(t){return n(this,t)}}):t.baseline=n}(window,window.jQuery||window.Zepto||void 0),function(t,e,n,r,a){"use strict";function i(t,e){return e.offset().top-t.offset().top-t.outerHeight()}function s(t,e){return e.offset().top-t.offset().top}function o(t,n,r,a,i){function s(t){return t.Liter=+t.Liter,t}var o=n,l=r,c=Math.min(o,l)/2,d=e.scaleOrdinal().range(a),u=e.arc().outerRadius(c-50).innerRadius(0),f=e.arc().outerRadius(c-10).innerRadius(c-10),p=i,v=e.select(t).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+o+" "+l).append("g").attr("class","g").attr("transform","translate("+.5*o+","+.5*l+")");v.append("g").attr("class","arcs"),v.append("g").attr("class","labels"),v.append("g").attr("class","lines");var h=e.pie().sort(null).value(function(t){return t.Liter});e.csv(p,s,function(t,e){if(t)throw t;var n=v.select(".arcs").selectAll(".arc").data(h(e)).enter();n.append("path").attr("class","arc").attr("d",u).style("stroke","#ffffff").style("stroke-linejoin","round").style("stroke-width",2).style("fill",function(t){return d(t.data.Kategorie)});var r=v.select(".labels").selectAll(".label").data(h(e)).enter();r.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform",function(t){return"translate("+f.centroid(t)+")"}).style("font-size","1.25em").style("color","#333").text(function(t){return t.data.Kategorie+": "+t.data.Liter});var a=v.select(".lines").selectAll(".line").data(h(e)).enter();a.append("circle").attr("class","lineCircle").attr("x",0).attr("y",0).attr("r",3).attr("fill","#333").attr("transform",function(t){return"translate("+u.centroid(t)+")"}),a.append("line").attr("class","line").attr("stroke-width",1).attr("stroke","#333").attr("x1",function(t){return u.centroid(t)[0]}).attr("y1",function(t){return u.centroid(t)[1]}).attr("x2",function(t){return.95*f.centroid(t)[0]}).attr("y2",function(t){return.95*f.centroid(t)[1]})})}function l(n,r,a,i,s,o){function l(t){return t.Liter=+t.Liter,t}var c=r,d=a,u=c-i.left-i.right,f=d-i.top-i.bottom,p=e.scaleBand().rangeRound([0,u]).padding(.1),v=e.scaleLinear().rangeRound([f,0]),h=e.select(n).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+c+" "+d).append("g").attr("class","g").attr("transform","translate("+i.left+","+i.top+")");e.csv(o,l,function(r,a){if(r)throw r;p.domain(a.map(function(t){return t.Stadt})),v.domain([0,e.max(a,function(t){return t.Liter})]),h.append("g").attr("class","bars"),h.append("g").attr("class","labels"),h.append("g").attr("class","axis"),h.select(".axis").append("g").attr("class","axis-x").attr("transform","translate(0, "+f+")").call(e.axisBottom(p)),h.select(".axis").append("g").attr("class","axis-y").call(e.axisLeft(v).ticks(10)).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("fill","#333").style("font-style","italic").text("Liter");var i=h.select(".bars").selectAll(".bar").data(a).enter();i.append("rect").attr("class","bar").attr("x",function(t){return p(t.Stadt)}).attr("y",function(t){return v(t.Liter)}).attr("width",p.bandwidth()).attr("height",function(t){return f-v(t.Liter)}),e.selectAll(n+" .bar").each(function(e,n){t(this).attr("fill",function(){return"Potsdam"===e.Stadt?s[1]:s[0]})});var o=h.select(".labels").selectAll(".label").data(a).enter();o.append("text").attr("class","label").attr("dy",".35em").attr("text-anchor","middle").attr("transform","translate(0, -10)").attr("x",function(t){return p(t.Stadt)+p.bandwidth()/2}).attr("y",function(t){return v(t.Liter)}).text(function(t){return t.Liter})})}function c(n,r,a,i,s,o,l){function c(t,e,n){t.Jahr=v(t.Jahr);for(var r,a=1,i=n.length;a<i;++a)t[r=n[a]]=+t[r];return t}var d=a,u=r,f=d-i.left-i.right,p=u-i.top-i.bottom,v=e.timeParse("%Y"),h=e.scaleTime().range([0,p]),g=e.scaleLinear().range([f,0]),m=e.scaleOrdinal().range(s),w=e.select(n).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+u+" "+d).append("g").attr("class","g").attr("transform","translate("+i.left+","+i.top+")"),y=e.line().curve(l).x(function(t){return h(t.date)}).y(function(t){return g(t.liter)});e.csv(o,c,function(r,a){if(r)throw r;var i=a.columns.slice(1).map(function(t){return{id:t,values:a.map(function(e){return{date:e.Jahr,liter:e[t]}})}});h.domain(e.extent(a,function(t){return t.Jahr})),g.domain([e.min(i,function(t){return e.min(t.values,function(t){return t.liter})}),e.max(i,function(t){return e.max(t.values,function(t){return t.liter})})]),m.domain(i.map(function(t){return t.id})),w.append("g").attr("class","axis"),w.append("g").attr("class","lines"),w.append("g").attr("class","labels"),w.append("g").attr("class","mouseovers"),w.select(".axis").append("g").attr("class","axis-x").attr("transform","translate(0, "+f+")").call(e.axisBottom(h)),w.select(".axis").append("g").attr("class","axis-y").call(e.axisLeft(g).ticks(20)).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("fill","#333").style("font-style","italic").text("Liter");var s=w.select(".lines").selectAll(".line").data(i).enter();s.append("path").attr("class",function(t){return"line line"+t.id}).attr("d",function(t){return y(t.values)}).style("fill","none").style("stroke-width",2).style("stroke",function(t){return m(t.id)});var o=w.select(".labels").selectAll(".label").data(i).enter();o.append("text").datum(function(t){return{id:t.id,value:t.values[t.values.length-1]}}).attr("class","label").attr("transform",function(t){return"translate("+h(t.value.date)+", "+g(t.value.liter)+")"}).attr("x",3).attr("dy","0.35em").style("font-size","1.1em").text(function(t){return t.id}),w.select(".mouseovers").append("path").attr("class","mouseLine").style("stroke","#333").style("stroke-width",1).style("opacity","0");var l=t(n+" .line"),c=w.select(".mouseovers").selectAll(".mousePerLine").data(i).enter().append("g").attr("class","mousePerLine");c.append("circle").attr("class","moCircle").attr("r",4).style("fill",function(t){return m(t.id)}).style("opacity","0"),c.append("rect").attr("class","moLabelBackground").style("fill","#fff"),c.append("text").attr("class","moText").style("font-size","1em");var d=t(n+" .moText"),u=e.range(d.length).map(function(){return{padding:1,boxHeight:20,translateX:10,translateY:3}});w.select(".mouseovers").append("rect").attr("width",p).attr("height",f).attr("pointer-events","all").style("fill","none").on("mouseout",function(){e.select(".mouseLine").style("opacity","0"),e.selectAll(".mousePerLine circle").style("opacity","0"),e.selectAll(".mousePerLine rect").style("opacity","0"),e.selectAll(".mousePerLine text").style("opacity","0")}).on("mouseover",function(){e.select(".mouseLine").style("opacity","1"),e.selectAll(".mousePerLine circle").style("opacity","1"),e.selectAll(".mousePerLine rect").style("opacity","0.75"),e.selectAll(".mousePerLine text").style("opacity","1")}).on("mousemove",function(){var n=e.mouse(this);e.selectAll(".moText").each(function(e,n){t(this).attr("transform","translate("+u[n].translateX+","+u[n].translateY+")"),u[n].boxWidth=1.5*t(this).outerWidth()}),e.selectAll(".moLabelBackground").each(function(e,n){t(this).attr("transform","translate("+(u[n].translateX-u[n].padding)+","+-4*u[n].translateY+")").attr("width",u[n].boxWidth).attr("height",u[n].boxHeight)}),e.select(".mouseLine").attr("d",function(){var t="M"+n[0]+","+f;return t+=" "+n[0]+",0"}),e.selectAll(".mousePerLine").attr("transform",function(t,r){for(var a=0,i=l[r].getTotalLength(),s=null,o=null;s=Math.floor((a+i)/2),o=l[r].getPointAtLength(s),s!==i&&s!==a||o.x===n[0];)if(o.x>n[0])i=s;else{if(!(o.x<n[0]))break;a=s}return e.select(this).select("text").text(g.invert(o.y).toFixed(2)),"translate("+n[0]+","+o.y+")"})})})}function d(e,n,r,a,i){"undefined"!==i&&null!==i||(i=!1),u.win.outerWidth()>=e?n.removeClass(r[0]).addClass(r[1]).css({left:r[2]}):n.removeClass(a[0]).addClass(a[1]).css({left:a[2]}),i&&t(".click-overlay").removeClass("visible")}var u={win:t(n),bod:t("body"),navContainer:t(".nav-container"),wide:t("main .wide"),navMain:{_this:t(".nav-main"),a:t(".nav-main a"),icon:{_this:t(".nav-main ul i"),gewinnung:t(".nav-main-gewinnung i"),versorgung:t(".nav-main-versorgung i"),reinigung:t(".nav-main-reinigung i"),natur:t(".nav-main-natur i"),last:t(".nav-main-last i")}},section:{intro:t("#section-intro"),natur:t("#section-natur")},icon:{_this:t(".container .icon i"),gewinnung:t("#section-gewinnung .icon i"),versorgung:t("#section-versorgung .icon i"),reinigung:t("#section-reinigung .icon i"),natur:t("#section-natur .icon i")},footer:{_this:t("footer")}},f={iconPositionsArr:{mainIcons:[u.icon.natur,u.icon.gewinnung,u.icon.versorgung,u.icon.reinigung,u.footer._this],navIcons:[u.navMain.icon.natur,u.navMain.icon.gewinnung,u.navMain.icon.versorgung,u.navMain.icon.reinigung,u.navMain.icon.last]},colors:{gewinnung:[40,137,179],versorgung:[56,115,184],reinigung:[130,154,175],natur:[46,156,204]},offset:{fromTop:.75}},p={wasserbedarf:{element:".d3Verteilung > .d3",w:600,h:600,colors:["#3873B8","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/taeglicher-gesamt-wasserbedarf-potsdams.csv"},wasserverbrauch:{element:".d3Verbrauch > .d3",w:600,h:680,margin:{top:20,right:40,bottom:20,left:40},colors:["#3873B8","#f44336","#2889B3","#2E9CCC","#829AAF"],data:"assets/data/wasserverbrauch-proportianal-bevoelkerungsdichte.csv",curveType:e.curveStep},wasserverbrauch2:{element:".d3Verbrauch2 > .d3",w:600,h:680,margin:{top:20,right:-60,bottom:40,left:40},colors:["#3873B8","#2889B3"],data:"assets/data/wasserverbrauch-vergleich-partnerstaedte.csv"}},v={Controller:new ScrollMagic.Controller,scene:{NavSticky:new ScrollMagic.Scene({triggerElement:"#section-intro",triggerHook:0,duration:s(u.section.intro,u.section.natur)})},cast:{NavSticky:function(){return v.scene.NavSticky.addTo(v.Controller).on("progress resize",function(t){var e=t.progress;.5<=e&&e<1?d(768,u.navMain._this,["retracted hidden mobileAtTop","extended",0,!0],["retracted mobileAtTop","hidden extended",0]):1===e?d(768,u.navMain._this,["retracted mobileAtTop","hidden extended",0],["retracted mobileAtTop","hidden extended",0]):d(768,u.navMain._this,["extended hidden mobile","retracted",u.navContainer.offset().left],["","extended hidden mobileAtTop",0])})},Weather:function(t){var e=t.attr("id"),n=t.find(".weather");return new ScrollMagic.Scene({triggerElement:"#"+e,triggerHook:.5,duration:3*u.win.outerHeight()}).addTo(v.Controller).on("progress leave",function(t){var e=t.progress.toFixed(1);.1<e&&e<=.9&&"leave"!==t.type?n.css("opacity",1):n.css("opacity",0)})},Flood:function(e){return e.each(function(e,n){var r=t(n);new ScrollMagic.Scene({triggerElement:n,triggerHook:.6,duration:r.outerHeight()}).addTo(v.Controller).on("progress",function(t){var e=t.progress.toFixed(4);r.children(".flood").children(".circle").css({transform:"scale("+1.5*e+")"}),e>=.25?r.addClass("showText"):r.removeClass("showText")}).on("update leave",function(t){"leave"===t.type&&"FORWARD"===t.target.controller().info("scrollDirection")&&r.next(".container").css("opacity",1)})})},Waterpipe:function(e,n){var r=[f.colors.natur,f.colors.gewinnung,f.colors.versorgung,f.colors.reinigung,f.colors.natur];return e.each(function(e,a){var s=t(a),o=[r[e+1][0]-r[e][0],r[e+1][1]-r[e][1],r[e+1][2]-r[e][2]],l=new ScrollMagic.Scene({triggerElement:a,triggerHook:f.offset.fromTop}).addTo(v.Controller).on("progress",function(t){var n=t.progress.toFixed(4),a=100*n,i=a+"%",l=a*n+"%",c=[Math.round(r[e][0]+o[0]*n),Math.round(r[e][1]+o[1]*n),Math.round(r[e][2]+o[2]*n)],d="linear-gradient(to bottom, rgb("+r[e][0]+","+r[e][1]+","+r[e][2]+") 0%, rgb("+c.join(",")+") 100%)";s.children(".water").css({background:d,height:l}),u.navMain.icon._this.eq(e).children(".waterpipeNav").children(".water").css({background:d,height:i})});u.win.on("resize",function(){l.duration(i(n[e],n[e+1])),l.refresh()})})}}};t(function(){u.icon._this.append('<div class="waterpipe"><div class="water"></div></div>'),u.navMain._this.children("ul").find("li:not(:last) i").append('<div class="waterpipeNav"><div class="water"></div></div>'),u.wide.prepend('<div class="flood"><div class="circle"></div></div>'),u.section.natur.prepend('<div class="weather"><div class="rain"></div></div>'),u.bod.prepend('<div class="click-overlay"></div>'),u.navMain._this.prepend('<div class="click-navOverlay"></div>'),t('.nav-main:not(.hidden) a[href^="#"]').bind("click.smoothscroll",function(e){e.preventDefault();var r=this.hash,a=t(r);t(".click-overlay").removeClass("visible"),t("html, body").stop().animate({scrollTop:a.offset().top},900,"swing",function(){n.location.hash=r,u.navMain._this.addClass("hidden")})}),u.navMain._this.children(".click-navOverlay").on("click",function(e){e.preventDefault();var n=t(this).parent();n.hasClass("hidden")&&(n.removeClass("hidden"),t(".click-overlay").addClass("visible"))}),t(".click-overlay").on("click",function(e){e.preventDefault(),t(this).removeClass("visible"),u.navMain._this.addClass("hidden")}),v.cast.Weather(t("#section-natur")),v.cast.Waterpipe(t(".waterpipe"),f.iconPositionsArr.mainIcons,"exponential"),v.cast.Flood(u.wide),v.cast.NavSticky(),o(p.wasserbedarf.element,p.wasserbedarf.w,p.wasserbedarf.h,p.wasserbedarf.colors,p.wasserbedarf.data),c(p.wasserverbrauch.element,p.wasserverbrauch.w,p.wasserverbrauch.h,p.wasserverbrauch.margin,p.wasserverbrauch.colors,p.wasserverbrauch.data,p.wasserverbrauch.curveType),l(p.wasserverbrauch2.element,p.wasserverbrauch2.w,p.wasserverbrauch2.h,p.wasserverbrauch2.margin,p.wasserverbrauch2.colors,p.wasserverbrauch2.data),u.win.trigger("resize")}),u.win.on("resize",function(){u.section.intro.css("min-height",u.win.outerHeight()),u.section.natur.css({height:3.5*u.win.outerHeight(),marginBottom:u.win.outerHeight()}),t(".weather").css("height",u.section.natur.outerHeight()),t(".waterpipe").each(function(e,n){t(n).css("height",i(f.iconPositionsArr.mainIcons[e],f.iconPositionsArr.mainIcons[e+1]))}),u.wide.each(function(e,n){var r=t(n),a={_this:r.find(".icon i"),size:r.find(".icon i").outerWidth()},i={posTop:a._this.position().top,posLeft:a._this.offset().left,size:function(){return r.outerWidth()>r.outerHeight()?r.outerWidth():r.outerHeight()}};r.children(".flood").children(".circle").css({left:i.posLeft+a.size/2-i.size(),top:i.posTop+a.size/2-i.size(),width:2*i.size(),height:2*i.size()})})}),u.win.on("resize scroll",function(){u.navMain._this.not(".hidden").children("ul").find("i").each(function(e,n){e<f.iconPositionsArr.navIcons.length-1&&t(n).children(".waterpipeNav").css("height",i(f.iconPositionsArr.navIcons[e],f.iconPositionsArr.navIcons[e+1]))})})}(jQuery,d3,window,document);